# Build PostGIS and importing natural earth using docker

- Docker compose for postgis

```yaml
version: '3.8'
services:
  ne_pg:
    image: postgis/postgis:12-master
    ports:
      - "5433:5432"
    restart: always
    environment:
      POSTGRES_PASSWORD: root
    volumes:
      - ./data:/var/lib/postgresql/data
      - ./import:/import
      - ./my-postgres.conf:/etc/postgresql/postgresql.conf
    command: postgres -c 'config_file=/etc/postgresql/postgresql.conf'
```

- postgis config file (generated by pgtune)

```plain
# WARNING
# this tool not being optimal
# for very high memory systems

# DB Version: 12
# OS Type: linux
# DB Type: dw
# Total Memory (RAM): 188 GB
# CPUs num: 40
# Connections num: 20
# Data Storage: hdd

listen_addresses = '*'
max_connections = 20
shared_buffers = 47GB
effective_cache_size = 141GB
maintenance_work_mem = 2GB
checkpoint_completion_target = 0.9
wal_buffers = 16MB
default_statistics_target = 500
random_page_cost = 4
effective_io_concurrency = 2
work_mem = 61603kB
min_wal_size = 4GB
max_wal_size = 16GB
max_worker_processes = 40
max_parallel_workers_per_gather = 20
max_parallel_workers = 40
max_parallel_maintenance_workers = 4
```

- Script for import natural earth

```bash
#!/bin/bash
if [ -f /.dockerenv ]; then
    ogr2ogr -nlt PROMOTE_TO_MULTI -f PostgreSQL PG:'dbname=postgres active_schema=ne host=localhost user=postgres password=root' /data/natural_earth_vector.gpkg
else
    docker run -v $(pwd):/data --rm --network host -it osgeo/gdal:ubuntu-small-latest /bin/bash /data/import.sh
fi
```